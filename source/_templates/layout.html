{% extends "!layout.html" %}

{% set script_files = script_files + ["https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.20.0/codemirror.min.js", "https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.20.0/mode/python/python.min.js","_static/jr.js"] %}

{% set bootswatch_css_custom = ['_static/easypython.css'] %}

{% block extrahead %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.20.0/codemirror.min.css"/>
{% endblock %}


{% block document %}
    {{ super() }}
		<script>
	  zonesCode = document.getElementsByClassName("easypython");
    codemirrors={}
    for(elem of zonesCode)
			codemirrors[elem.parentNode.id] = CodeMirror( function(elt) {
					elem.parentNode.replaceChild(elt, elem);
		  },
			{
      value: elem.innerHTML,
      mode:"python"
   	});
	</script>
  <script>
   function soumettre(hash){

		currentCM=codemirrors[hash]
		 fetch('api/v1/tentative/',
      {
        mode:'cors',
        method: 'POST',
        credentials: 'include',
        body: JSON.stringify(
          {
            'contenu':currentCM.getValue(),
            'hash': hash
          }),
        headers:{
          'content-type':'application/json'
        }
      })
      .then(reponse => {
        if (reponse.ok) {
    			currentCM.setOption('readOnly',true)
          alert("REUSSI")
        } else {
          alert("Rate")
        }
      })

		zoneExo=currentCM.parentNode
}
</script>
{% endblock %}
